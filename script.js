const wallets = {
    extraSmall: [
        { 
            tonscan: 'https://tonscan.org/address/EQDz5ABKpaMO8BunzgNpcG8TAHvleDXGjSqIi6nOf5cLsFKg',
            url: 'EQDz5ABKpaMO8BunzgNpcG8TAHvleDXGjSqIi6nOf5cLsFKg',
            maxBalance: 350000000,
            id: 'Grenei'
        },
        { 
            tonscan: 'https://tonscan.org/address/EQB0wM5SSGxOMQW1kiA_CSnZi8xONhr2EaH0-DH3ErshW_kT',
            url: 'EQB0wM5SSGxOMQW1kiA_CSnZi8xONhr2EaH0-DH3ErshW_kT',
            maxBalance: 350000000,
            id: 'Bevro'
        },
        { 
            tonscan: 'https://tonscan.org/address/EQDifNns50Ial2wezfhHT69ycmucPjQvbVa8qLsbFoVqN9_-',
            url: 'EQDifNns50Ial2wezfhHT69ycmucPjQvbVa8qLsbFoVqN9_-',
            maxBalance: 350000000,
            id: 'Bragie'
        },
        { 
            tonscan: 'https://tonscan.org/address/EQDMI8s3OcoaM5A9OhIOj8lh1jqGVoJc4rouNi1XPIu5YcXh',
            url: 'EQDMI8s3OcoaM5A9OhIOj8lh1jqGVoJc4rouNi1XPIu5YcXh',
            maxBalance: 350000000,
            id: 'Ovyt'
        },
        { 
            tonscan: 'https://tonscan.org/address/EQCGGM9fF9hmvAt7OLWZKbX0tf3A5ZrCF7EW5mmdUk3wkqGm',
            url: 'EQCGGM9fF9hmvAt7OLWZKbX0tf3A5ZrCF7EW5mmdUk3wkqGm',
            maxBalance: 350000000,
            id: 'Elzrir'
        },
        { 
            tonscan: 'https://tonscan.org/address/EQCh7TvrKTFF1shor0ni2SsDF2poyGltxgWaJYOY6J3kqi1G',
            url: 'EQCh7TvrKTFF1shor0ni2SsDF2poyGltxgWaJYOY6J3kqi1G',
            maxBalance: 350000000,
            id: 'Orsot'
        },
        { 
            tonscan: 'https://tonscan.org/address/EQB3zmSjxPn2c-EcbDAzYiPZtbPi8DkxdcnjHYKRG3xealN0',
            url: 'EQB3zmSjxPn2c-EcbDAzYiPZtbPi8DkxdcnjHYKRG3xealN0',
            maxBalance: 350000000,
            id: 'Brandred'
        },
        { 
            tonscan: 'https://tonscan.org/address/EQBFUICbJRNPrV1Q6RN12oq7TNc87hkyV_8stbQOn5Q0ddd2',
            url: 'EQBFUICbJRNPrV1Q6RN12oq7TNc87hkyV_8stbQOn5Q0ddd2',
            maxBalance: 350000000,
            id: 'Gotontom'
        },
        { 
            tonscan: 'https://tonscan.org/address/EQA-9Z_fJ3PstFkCoZIMij9xM3SVEJfqYtv-x8tKfUlb0Bh5',
            url: 'EQA-9Z_fJ3PstFkCoZIMij9xM3SVEJfqYtv-x8tKfUlb0Bh5',
            maxBalance: 350000000,
            id: 'Gridrurus'
        },
        { 
            tonscan: 'https://tonscan.org/address/EQDKx_EepIPaTIBiaCLbyQn23cyxHQ2UhZxZWf34AKi-MrPN',
            url: 'EQDKx_EepIPaTIBiaCLbyQn23cyxHQ2UhZxZWf34AKi-MrPN',
            maxBalance: 350000000,
            id: 'Goithaysdy'
        },
    ],
    small: [
        { 
            tonscan: 'https://tonscan.org/address/EQAdbzmwgiGzoO8Qd9TaXez1_glc3u5k5OhyVP19eQU6_w8u',
            url: 'EQAdbzmwgiGzoO8Qd9TaXez1_glc3u5k5OhyVP19eQU6_w8u',
            maxBalance: 75000000,
            id: 'Zordag'
        },
        { 
            tonscan: 'https://tonscan.org/address/EQDAsvqI2NjvIQRgBZlJlLgE1O_qCbhLF0JHJaCacN5JYqlh',
            url: 'EQDAsvqI2NjvIQRgBZlJlLgE1O_qCbhLF0JHJaCacN5JYqlh',
            maxBalance: 75000000,
            id: 'Diergy'
        },
        /*{ 
            url: 'EQB32_v8qa1Acdbxu4o_fe6XkiyBNWwjeyzSmFYOH4E8siAI',
            maxBalance: 75000000,
            id: 'Graghais'
        },
        */
        { 
            tonscan: 'https://tonscan.org/address/EQBt17w56e3ZJTl2KlVOt8sNYecHHhOOfM2n4G7vDSlh5bpi',
            url: 'EQBt17w56e3ZJTl2KlVOt8sNYecHHhOOfM2n4G7vDSlh5bpi',
            maxBalance: 75000000,
            id: 'Froiddry'
        },
        { 
            tonscan: 'https://tonscan.org/address/EQAVYeKiun0grXNECt2A-m3N9jmX4eLFazefhmpfATZv_3nd',
            url: 'EQAVYeKiun0grXNECt2A-m3N9jmX4eLFazefhmpfATZv_3nd',
            maxBalance: 75000000,
            id: 'Zovraim'
        },
        { 
            tonscan: 'https://tonscan.org/address/EQCGGMVDNldf8rEk7Kes5lylUrONdXq9qSg2OO2u-fC-6AHP',
            url: 'EQCGGMVDNldf8rEk7Kes5lylUrONdXq9qSg2OO2u-fC-6AHP',
            maxBalance: 75000000,
            id: 'Ytynth'
        },
        { 
            tonscan: 'https://tonscan.org/address/EQCmEkx3VXRdbkvqs6qic91cxphZsPS2vAUvN70qWymbKa_a',
            url: 'EQCmEkx3VXRdbkvqs6qic91cxphZsPS2vAUvN70qWymbKa_a',
            maxBalance: 75000000,
            id: 'Guvanar'
        },
        { 
            tonscan: 'https://tonscan.org/address/EQBQ9V9FSSnbG180zmshd7jDgqiUiCXH-oYerS1-Z66juHBd',
            url: 'EQBQ9V9FSSnbG180zmshd7jDgqiUiCXH-oYerS1-Z66juHBd',
            maxBalance: 75000000,
            id: 'Omecra'
        },
        { 
            tonscan: 'https://tonscan.org/address/EQBLstaZ2tad5CSg-uVP76fwvj_K8SBrkOvLKP7pCEYAmHFY',
            url: 'EQBLstaZ2tad5CSg-uVP76fwvj_K8SBrkOvLKP7pCEYAmHFY',
            maxBalance: 75000000,
            id: 'Nygasdot'
        },
        {
            tonscan: 'https://tonscan.org/address/EQC7FvnqMqEltKvFyuGiNnfJLh-d8Ej0HieRp73l0NoyJtj4',
            url: 'EQC7FvnqMqEltKvFyuGiNnfJLh-d8Ej0HieRp73l0NoyJtj4',
            maxBalance: 75000000,
            id: 'Jodrog'
        },
    ],
    medium: [
        { 
            tonscan: 'https://tonscan.org/address/EQDuVMbAnnQr9Ecxd2sDIc5TDjgRgcFCLyL4sEOLUuTAYDEO',
            url: 'EQDuVMbAnnQr9Ecxd2sDIc5TDjgRgcFCLyL4sEOLUuTAYDEO',
            maxBalance: 50000000,
            id: 'Dyrso'
        },
        { 
            tonscan: 'https://tonscan.org/address/EQCYlzcaWPnHZu2koCLyXh9Jw9wQwRbqaqNIw2bhkfQaFdW8',
            url: 'EQCYlzcaWPnHZu2koCLyXh9Jw9wQwRbqaqNIw2bhkfQaFdW8',
            maxBalance: 50000000,
            id: 'Dodrig'
        },
        { 
            tonscan: 'https://tonscan.org/address/EQBD5hih9xsfWEN41tJPMvabiLaz1jh86KkM9nKG3hOq1DO-',
            url: 'EQBD5hih9xsfWEN41tJPMvabiLaz1jh86KkM9nKG3hOq1DO-',
            maxBalance: 50000000,
            id: 'Jardenth'
        },
        { 
            tonscan: 'https://tonscan.org/address/EQBuGoJmb8aUOMd0yt4pkevSY1WEWGyHyQkyTMOZZw4fnZhS',
            url: 'EQBuGoJmb8aUOMd0yt4pkevSY1WEWGyHyQkyTMOZZw4fnZhS',
            maxBalance: 50000000,
            id: 'Emmur'
        },
        { 
            tonscan: 'https://tonscan.org/address/EQBKkIbu4suW_V8yzB3hBqDXOD_fe7w4jOWpf0231XSNMmC7',
            url: 'EQBKkIbu4suW_V8yzB3hBqDXOD_fe7w4jOWpf0231XSNMmC7',
            maxBalance: 50000000,
            id: 'Raldre'
        },
        { 
            tonscan: 'https://tonscan.org/address/EQD5VUfl0vs24Pcf1dj6LV5La7prfn1lbzhrcgQ33lm5v1zM',
            url: 'EQD5VUfl0vs24Pcf1dj6LV5La7prfn1lbzhrcgQ33lm5v1zM',
            maxBalance: 50000000,
            id: 'Kalriden'
        },
        { 
            tonscan: 'https://tonscan.org/address/EQBwKfqIlQ3HkDuS1MiNlUc0h77xYL1N7YeowU49sDwnwDfU',
            url: 'EQBwKfqIlQ3HkDuS1MiNlUc0h77xYL1N7YeowU49sDwnwDfU',
            maxBalance: 50000000,
            id: 'Zynnorris'
        },
        { 
            tonscan: 'https://tonscan.org/address/EQBp8dVtgqMOdFmo4zF0Q3S8p37M4riJ4HKDWN3f4kzpbSjD',
            url: 'EQBp8dVtgqMOdFmo4zF0Q3S8p37M4riJ4HKDWN3f4kzpbSjD',
            maxBalance: 50000000,
            id: 'Jyrrydoss'
        },
        { 
            tonscan: 'https://tonscan.org/address/EQC9MrbOn_RAbzBqPbm9OZmDOZipE_F9_DyAjBlRnZnzpRTu',
            url: 'EQC9MrbOn_RAbzBqPbm9OZmDOZipE_F9_DyAjBlRnZnzpRTu',
            maxBalance: 50000000,
            id: 'Celbyss'
        },
        { 
            tonscan: 'https://tonscan.org/address/EQAn8xg-0ertl0ATCSeKdywVXHrXyjv3gRg6ofy83IEmmv5T',
            url: 'EQAn8xg-0ertl0ATCSeKdywVXHrXyjv3gRg6ofy83IEmmv5T',
            maxBalance: 50000000,
            id: 'Qokos'
        },
    ],
    large: [
        { 
            tonscan: 'https://tonscan.org/address/EQAHayh7282LwrdvEN9DpVgSzK_Z4lgNsbFRtEehiV0Bjy8D',
            url: 'EQAHayh7282LwrdvEN9DpVgSzK_Z4lgNsbFRtEehiV0Bjy8D',
            maxBalance: 25000000,
            id: 'Bavaid'
        },
        { 
            tonscan: 'https://tonscan.org/address/EQCg7Bjedg1TXm4zzwt1-_YgaCjzSdxXrNzHTv0978eaHEPL',
            url: 'EQCg7Bjedg1TXm4zzwt1-_YgaCjzSdxXrNzHTv0978eaHEPL',
            maxBalance: 25000000,
            id: 'Rezam'
        },
        { 
            tonscan: 'https://tonscan.org/address/EQBnt4TnEunxoTnbVFN3i1UcNFYH4y3NnLha7i0BwGFpfR0d',
            url: 'EQBnt4TnEunxoTnbVFN3i1UcNFYH4y3NnLha7i0BwGFpfR0d',
            maxBalance: 25000000,
            id: 'Roilbo'
        },
        { 
            tonscan: 'https://tonscan.org/address/EQCiMbkesO1ky9lnfFcA3oc8W8DUrd2Giv1Jx9EsL9lifYVV',
            url: 'EQCiMbkesO1ky9lnfFcA3oc8W8DUrd2Giv1Jx9EsL9lifYVV',
            maxBalance: 25000000,
            id: 'Ammass'
        },
        { 
            tonscan: 'https://tonscan.org/address/EQBpPJW0LD6JWBdfPbRZjdlO2oduMNV9DiTSvnvUbL5ZbD_S',
            url: 'EQBpPJW0LD6JWBdfPbRZjdlO2oduMNV9DiTSvnvUbL5ZbD_S',
            maxBalance: 25000000,
            id: 'Myron'
        },
        { 
            tonscan: 'https://tonscan.org/address/EQAMYy1yijpkHX9yqMvSSr2CeIEiQRuhy50EoCHTMo4gaGY1',
            url: 'EQAMYy1yijpkHX9yqMvSSr2CeIEiQRuhy50EoCHTMo4gaGY1',
            maxBalance: 25000000,
            id: 'Gairris'
        },
        { 
            tonscan: 'https://tonscan.org/address/EQCakdHQb-6O89M65VFB9ryN637s3P0-uk8-yZ4WGVEsu-He',
            url: 'EQCakdHQb-6O89M65VFB9ryN637s3P0-uk8-yZ4WGVEsu-He',
            maxBalance: 25000000,
            id: 'Frizag'
        },
        { 
            tonscan: 'https://tonscan.org/address/EQA8g2QX0WGIb3Papznpo1BoFrmYRoCp5NsLQXP-o8qMI95I',
            url: 'EQA8g2QX0WGIb3Papznpo1BoFrmYRoCp5NsLQXP-o8qMI95I',
            maxBalance: 25000000,
            id: 'Chamaicross'
        },
        { 
            tonscan: 'https://tonscan.org/address/EQA_FZx8tpyPyAN6ZXssaAh3vqReoDe3MdCar7aj_9Ixe6tP',
            url: 'EQA_FZx8tpyPyAN6ZXssaAh3vqReoDe3MdCar7aj_9Ixe6tP',
            maxBalance: 25000000,
            id: 'Chervecrit'
        },
        { 
            tonscan: 'https://tonscan.org/address/EQCHhMzHF_mh1fiahPoXPuyWuohpUtMwVorD-zpvxfgmsq0J',
            url: 'EQCHhMzHF_mh1fiahPoXPuyWuohpUtMwVorD-zpvxfgmsq0J',
            maxBalance: 25000000,
            id: 'Edrocrurth'
        },
    ],
};

async function getWalletBalance(address) {
    try {
        const response = await fetch(`https://toncenter.com/api/v3/jetton/wallets?address=${address}&api_key=01516c4c0a0894722f530c3d04dede857bef2731d24fa84cb9ffad580dc5d5ba`);
        const data = await response.json();
        const jettonWallets = data.jetton_wallets;
        if (Array.isArray(jettonWallets) && jettonWallets.length > 0) {
            return jettonWallets[0].balance;
        } else {
            throw new Error('Incorrect server response');
        }
    } catch (error) {
        console.error('Error while fetching balance:', error.message);
        return null;
    }
}

async function updateWallet(wallet) {
    try {
        const balanceString = await getWalletBalance(wallet.url);
        let balance = balanceString.replace(/0+$/, '');
        balance = balance.replace(/\B(?=(\d{3})+(?!\d))/g, ' ');

        const remainingBalance = wallet.maxBalance;

        const progressBarWidth = (parseFloat(balance.replace(/\s/g, '')) / wallet.maxBalance) * 100;

        const walletElement = document.getElementById(wallet.url);
        if (walletElement) {
            walletElement.querySelector('.balance').textContent = `Remaining: ${balance} (${progressBarWidth.toFixed(2)}%)`;
            walletElement.querySelector('.remaining').textContent = `Сapacity: ${remainingBalance.toLocaleString()}`;
            walletElement.querySelector('.status-fill').style.width = `${progressBarWidth}%`;
        } else {
            console.error('Wallet not found', wallet.url);
        }
    } catch (error) {
        console.error('Error while updating wallet info');
    }
}

async function updateWallets() {
    try {
        for (const category in wallets) {
            for (const wallet of wallets[category]) {
                await updateWallet(wallet);
                await new Promise(resolve => setTimeout(resolve, 2000));
            }
        }
    } catch (error) {
        console.error('Error while updating wallet info');
    }
}


document.addEventListener('DOMContentLoaded', async () => {
    try {
        for (const category in wallets) {
            const categoryElement = document.getElementById(`${category}Wallets`);
            for (const wallet of wallets[category]) {
                const walletElement = document.createElement('div');
                walletElement.classList.add('wallet');
                walletElement.id = wallet.url; 
                walletElement.innerHTML = `
                <!-- HTML -->
                <div class="wallet-card" id="${wallet.url}">
                    <div class="wallet-info">
                        <p><i class="bi bi-box"></i><b> Giver ${wallet.id}</b></p>
                        <span>
                        <a href="${wallet.tonscan}" target="_blank" class="tonscan">
                        tonscan
                        </a>
                        </span>
                        <p class="balance">Remaining: loading...</p>
                        <p class="remaining">Сapacity: loading...</p>
                    </div>
                    <div class="status-bar">
                        <div class="status-fill"></div>
                    </div>
                </div>                
                `;
                categoryElement.appendChild(walletElement);
            }
        }
    } catch (error) {
        console.error('Error while page rendering:', error.message);
    }
    
    setInterval(updateWallets, 5000);
});
