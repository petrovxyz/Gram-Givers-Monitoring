const wallets = {
    extraSmall: [
        { 
            url: 'https://tonviewer.com/EQCfwe95AJDfKuAoP1fBtu-un1yE7Mov-9BXaFM3lrJZwqg_/jetton/EQC47093oX5Xhb0xuk2lCr2RhS8rj-vul61u4W2UH5ORmG_O',
            maxBalance: 350000000,
            id: 'Grenei'
        },
        { 
            url: 'https://tonviewer.com/EQBoATvbIa9vA7y8EUQE4tlsrrt0EhSUK4mndp49V0z7Me3M/jetton/EQC47093oX5Xhb0xuk2lCr2RhS8rj-vul61u4W2UH5ORmG_O',
            maxBalance: 350000000,
            id: 'Bevro'
        },
        { 
            url: 'https://tonviewer.com/EQAV3tsPXau3VJanBw4KCFaMk3l_n3sX8NHZNgICFrR-9EGE/jetton/EQC47093oX5Xhb0xuk2lCr2RhS8rj-vul61u4W2UH5ORmG_O',
            maxBalance: 350000000,
            id: 'Bragie'
        },
        { 
            url: 'https://tonviewer.com/EQAR9DvLZMHo9FAVMHI1vHvL7Fi7jWgjKtUARZ2S_nopQRYz/jetton/EQC47093oX5Xhb0xuk2lCr2RhS8rj-vul61u4W2UH5ORmG_O',
            maxBalance: 350000000,
            id: 'Ovyt'
        },
        { 
            url: 'https://tonviewer.com/EQC10L__G2SeEeM2Lw9osGyYxhoIPqJwE-8Pe7728JcmnJzW/jetton/EQC47093oX5Xhb0xuk2lCr2RhS8rj-vul61u4W2UH5ORmG_O',
            maxBalance: 350000000,
            id: 'Elzrir'
        },
        { 
            url: 'https://tonviewer.com/EQDZJFkh12kw-zLGqKSGVDf1V2PRzedGZDFDcFml5_0QerST/jetton/EQC47093oX5Xhb0xuk2lCr2RhS8rj-vul61u4W2UH5ORmG_O',
            maxBalance: 350000000,
            id: 'Orsot'
        },
        { 
            url: 'https://tonviewer.com/EQCiLN0gEiZqthGy-dKl4pi4kqWJWjRzR3Jv4jmPOtQHveDN/jetton/EQC47093oX5Xhb0xuk2lCr2RhS8rj-vul61u4W2UH5ORmG_O',
            maxBalance: 350000000,
            id: 'Brandred'
        },
        { 
            url: 'https://tonviewer.com/EQDB8Mo9EviBkg_BxfNv6C2LO_foJRXcgEF41pmQvMvnB9Jn/jetton/EQC47093oX5Xhb0xuk2lCr2RhS8rj-vul61u4W2UH5ORmG_O',
            maxBalance: 350000000,
            id: 'Gotontom'
        },
        { 
            url: 'https://tonviewer.com/EQAidDzp6v4oe-vKFWvsV8MQzY-4VaeUFnGM3ImrKIJUIid9/jetton/EQC47093oX5Xhb0xuk2lCr2RhS8rj-vul61u4W2UH5ORmG_O',
            maxBalance: 350000000,
            id: 'Gridrurus'
        },
        { 
            url: 'https://tonviewer.com/EQAFaPmLLhXveHcw3AYIGDlHbGAbfQWlH45WGf4K4D6DNZxY/jetton/EQC47093oX5Xhb0xuk2lCr2RhS8rj-vul61u4W2UH5ORmG_O',
            maxBalance: 350000000,
            id: 'Goithaysdy'
        },
    ],
    small: [
        { 
            url: 'https://tonviewer.com/EQDSGvoktoIRTL6fBEK_ysS8YvLoq3cqW2TxB_xHviL33ex2/jetton/EQC47093oX5Xhb0xuk2lCr2RhS8rj-vul61u4W2UH5ORmG_O',
            maxBalance: 75000000,
            id: 'Zordag'
        },
        { 
            url: 'https://tonviewer.com/EQCvMmHhSYStEtUAEDrpV39T2GWl-0K-iqCxSSZ7I96L4yow/jetton/EQC47093oX5Xhb0xuk2lCr2RhS8rj-vul61u4W2UH5ORmG_O',
            maxBalance: 75000000,
            id: 'Diergy'
        },
        { 
            url: 'https://tonviewer.com/EQBvumwjKe7xlrjc22p2eLGT4UkdRnrmqmcEYT94J6ZCINmt/jetton/EQC47093oX5Xhb0xuk2lCr2RhS8rj-vul61u4W2UH5ORmG_O',
            maxBalance: 75000000,
            id: 'Graghais'
        },
        { 
            url: 'https://tonviewer.com/EQDEume45yzDIdSy_Cdz7KIKZk0HyCFIr0yKdbtMyPfFUkbl/jetton/EQC47093oX5Xhb0xuk2lCr2RhS8rj-vul61u4W2UH5ORmG_O',
            maxBalance: 75000000,
            id: 'Froiddry'
        },
        { 
            url: 'https://tonviewer.com/EQAO7jXcX-fJJZl-kphbpdhbIDUqcAiYcAr9RvVlFl38Uatt/jetton/EQC47093oX5Xhb0xuk2lCr2RhS8rj-vul61u4W2UH5ORmG_O',
            maxBalance: 75000000,
            id: 'Zovraim'
        },
        { 
            url: 'https://tonviewer.com/EQAvheS_G-U57CE55UlwF-3M-cc4cljbLireYCmAMe_RHWGF/jetton/EQC47093oX5Xhb0xuk2lCr2RhS8rj-vul61u4W2UH5ORmG_O',
            maxBalance: 75000000,
            id: 'Ytynth'
        },
        { 
            url: 'https://tonviewer.com/EQCba5q9VoYGgiGykVazOUZ49UK-1RljUeZgU6E-bW0bqF2Z/jetton/EQC47093oX5Xhb0xuk2lCr2RhS8rj-vul61u4W2UH5ORmG_O',
            maxBalance: 75000000,
            id: 'Guvanar'
        },
        { 
            url: 'https://tonviewer.com/EQCzT8Pk1Z_aMpNukdV-Mqwc6LNaCNDt-HD6PiaSuEeCD0hV/jetton/EQC47093oX5Xhb0xuk2lCr2RhS8rj-vul61u4W2UH5ORmG_O',
            maxBalance: 75000000,
            id: 'Omecra'
        },
        { 
            url: 'https://tonviewer.com/EQDglg3hI89dySlr-FR_d1GQCMirkLZH6TPF-NeojP-DbSgY/jetton/EQC47093oX5Xhb0xuk2lCr2RhS8rj-vul61u4W2UH5ORmG_O',
            maxBalance: 75000000,
            id: 'Nygasdot'
        },
        { 
            url: 'https://tonviewer.com/EQDIDs45shbXRwhnXoFZg303PkG2CihbVvQXw1k0_yVIqxcA/jetton/EQC47093oX5Xhb0xuk2lCr2RhS8rj-vul61u4W2UH5ORmG_O',
            maxBalance: 75000000,
            id: 'Jodrog'
        },
    ],
};

async function getWalletBalance(walletURL) {
    try {
        const response = await fetch(walletURL);
        const html = await response.text();
        
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        
        const balanceElement = doc.querySelector('.t1gmfwv5.n1uax993.b1l85tie'); 
        if (balanceElement) {
            const balanceText = balanceElement.textContent.trim().replace(/[^0-9.,]/g, ''); 
            const balance = parseFloat(balanceText.replace(/,/g, '')); 
            return balance;
        } else {
            throw new Error('Баланс не найден на странице');
        }
    } catch (error) {
        console.error('Ошибка при парсинге баланса:', error.message);
        return null;
    }
}

async function updateWallet(wallet) {
    try {
        const balance = await getWalletBalance(wallet.url);
        const remainingBalance = wallet.maxBalance;
        const progressBarWidth = (balance / wallet.maxBalance) * 100;

        const walletElement = document.getElementById(wallet.url);
        if (walletElement) {
            walletElement.querySelector('.balance').textContent = `Remaining: ${balance.toLocaleString()}`;
            walletElement.querySelector('.remaining').textContent = `Сapacity: ${remainingBalance.toLocaleString()}`;
            walletElement.querySelector('.status-fill').style.width = `${progressBarWidth}%`; 
        } else {
            console.error('Элемент кошелька не найден:', wallet.url);
        }
    } catch (error) {
        console.error('Ошибка при обновлении информации о кошельке:', error.message);
    }
}

async function updateWallets() {
    try {
        for (const category in wallets) {
            for (const wallet of wallets[category]) {
                await updateWallet(wallet);
            }
        }
    } catch (error) {
        console.error('Ошибка при обновлении информации о кошельках:', error.message);
    }
}

document.addEventListener('DOMContentLoaded', async () => {
    try {
        for (const category in wallets) {
            const categoryElement = document.getElementById(`${category}Wallets`);
            for (const wallet of wallets[category]) {
                const walletElement = document.createElement('div');
                walletElement.classList.add('wallet');
                walletElement.id = wallet.url; 
                walletElement.innerHTML = `
                <!-- HTML -->
                <div class="wallet-card" id="${wallet.url}">
                    <div class="wallet-info">
                        <p><i class="bi bi-box"></i><b> Giver ${wallet.id}</b></p><a href="${wallet.url}">Tonviewer</a>
                        <p class="balance">Remaining: loading...</p>
                        <p class="remaining">Сapacity: loading...</p>
                    </div>
                    <div class="status-bar">
                        <div class="status-fill"></div>
                    </div>
                </div>                
                `;
                categoryElement.appendChild(walletElement);
            }
        }
    } catch (error) {
        console.error('Ошибка при инициализации страницы:', error.message);
    }
    
    setInterval(updateWallets, 5000);
});
